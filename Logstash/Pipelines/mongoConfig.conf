input {
   jdbc {
     jdbc_driver_library => "/usr/share/logstash/logstash-core/lib/jars/mongojdbc2.3.jar"
     jdbc_driver_class => "com.dbschema.MongoJdbcDriver"
     jdbc_connection_string => "jdbc:mongodb://mongo/availability"
	 jdbc_user => ""
	 
     statement => "
		var lastValue = :sql_last_value;
		var extractedDate = lastValue.substring(0,10);
		var extractedTime = lastValue.substring(11,19);
		var concatDateTime = extractedDate + 'T' + extractedTime + 'Z';
		db.rooms.find({ updatedDate: { $gt : new ISODate(concatDateTime)} },{'_id': false})"
	 schedule => "/5 * * * * *"
	 type => "availability"
  } 
}

output {

  stdout { codec => json }
  
  stdout { codec => rubydebug  }

  elasticsearch { 
	index => "availability"
	hosts => ["elasticsearch:9200"]
  }
}